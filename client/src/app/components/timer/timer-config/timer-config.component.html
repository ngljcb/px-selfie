<div class="config-container">

  <div class="config-header">
    <h2>Configurazione</h2>
    <button class="close-btn" (click)="cancel()">
      <span>‚úï</span>
    </button>
  </div>

  <div class="mode-switch">
    <button 
      class="mode-btn" 
      [class.active]="isManualMode"
      (click)="switchToManual()">
      <span class="mode-icon">‚öôÔ∏è</span>
      <span class="mode-text">Configurazione Manuale</span>
    </button>
    <button 
      class="mode-btn" 
      [class.active]="!isManualMode"
      (click)="switchToAutomatic()">
      <span class="mode-icon">üéØ</span>
      <span class="mode-text">Suggerimenti Automatici</span>
    </button>
  </div>

  <form [formGroup]="configForm" class="config-form">

    <div class="manual-mode" *ngIf="isManualMode">
      <div class="form-section">
        <h3>Imposta i parametri</h3>
        
        <div class="form-grid">
          <div class="form-group">
            <label for="studyMinutes">Studio (minuti)</label>
            <input 
              type="number" 
              id="studyMinutes"
              formControlName="studyMinutes"
              min="1" 
              max="120"
              class="form-input">
            <div class="input-error" 
                 *ngIf="configForm.get('studyMinutes')?.invalid && configForm.get('studyMinutes')?.touched">
              Inserisci un valore tra 1 e 120 minuti
            </div>
          </div>

          <div class="form-group">
            <label for="breakMinutes">Pausa (minuti)</label>
            <input 
              type="number" 
              id="breakMinutes"
              formControlName="breakMinutes"
              min="1" 
              max="30"
              class="form-input">
            <div class="input-error" 
                 *ngIf="configForm.get('breakMinutes')?.invalid && configForm.get('breakMinutes')?.touched">
              Inserisci un valore tra 1 e 30 minuti
            </div>
          </div>

          <div class="form-group">
            <label for="totalCycles">Cicli</label>
            <input 
              type="number" 
              id="totalCycles"
              formControlName="totalCycles"
              min="1" 
              max="20"
              class="form-input">
            <div class="input-error" 
                 *ngIf="configForm.get('totalCycles')?.invalid && configForm.get('totalCycles')?.touched">
              Inserisci un valore tra 1 e 20 cicli
            </div>
          </div>
        </div>

        <div class="config-preview">
          <div class="preview-title">Anteprima:</div>
          <div class="preview-text">{{ getPreviewText() }}</div>
        </div>
      </div>
    </div>

    <div class="automatic-mode" *ngIf="!isManualMode">
      <div class="form-section">
        <h3>Quanto tempo hai a disposizione?</h3>
        
        <div class="time-input-group">

          <div class="time-inputs-container">
            <div class="time-input-wrapper">
              <input 
                type="number" 
                id="totalTimeHours"
                formControlName="totalTimeHours"
                min="0" 
                max="8"
                (input)="onTotalTimeChange()"
                class="form-input time-input"
                placeholder="0">
              <label for="totalTimeHours" class="time-label">ore</label>
            </div>
            
            <div class="time-separator"></div>
            
            <div class="time-input-wrapper">
              <input 
                type="number" 
                id="totalTimeMinutes"
                formControlName="totalTimeMinutes"
                min="0" 
                max="59"
                (input)="onTotalTimeChange()"
                class="form-input time-input"
                placeholder="0">
              <label for="totalTimeMinutes" class="time-label">minuti</label>
            </div>
          </div>
          
          <div class="time-helper">
            <span class="time-format">{{ formatTimeDisplay() }}</span>
          </div>
          
          <div class="input-error" 
               *ngIf="(configForm.get('totalTimeHours')?.invalid && configForm.get('totalTimeHours')?.touched) || 
                      (configForm.get('totalTimeMinutes')?.invalid && configForm.get('totalTimeMinutes')?.touched)">
            Inserisci un tempo valido (massimo 8 ore)
          </div>
          
          <div class="input-error" 
               *ngIf="getTotalTimeInMinutes() < 10 && getTotalTimeInMinutes() > 0">
            Tempo minimo: 10 minuti
          </div>
        </div>

        <div class="proposals-section" *ngIf="proposals.length > 0">
          <h4>Proposte consigliate:</h4>
          
          <div class="proposals-grid">
            <div 
              class="proposal-card" 
              *ngFor="let proposal of proposals"
              [class.selected]="selectedProposal?.id === proposal.id"
              (click)="selectProposal(proposal)">
              
              <div class="proposal-header">
                <div class="proposal-name">{{ proposal.name }}</div>
                <div class="proposal-check" *ngIf="selectedProposal?.id === proposal.id">‚úì</div>
              </div>
              
              <div class="proposal-details">
                <div class="proposal-stats">
                  <div class="stat">
                    <span class="stat-label">Studio:</span>
                    <span class="stat-value">{{ formatTime(proposal.studyTime) }}</span>
                  </div>
                  <div class="stat" *ngIf="proposal.breakTime > 0">
                    <span class="stat-label">Pausa:</span>
                    <span class="stat-value">{{ formatTime(proposal.breakTime) }}</span>
                  </div>
                  <div class="stat">
                    <span class="stat-label">Cicli:</span>
                    <span class="stat-value">{{ proposal.totalCycles }}</span>
                  </div>
                </div>
                <div class="proposal-breakdown">{{ proposal.details }}</div>
              </div>
            </div>
          </div>
        </div>

        <div class="no-proposals" *ngIf="proposals.length === 0 && getTotalTimeInMinutes() >= 10">
          <p>Nessuna proposta disponibile per questo tempo</p>
        </div>
        
        <div class="no-proposals" *ngIf="getTotalTimeInMinutes() < 10 && getTotalTimeInMinutes() > 0">
          <p>Inserisci almeno 10 minuti per vedere le proposte</p>
        </div>
      </div>
    </div>
  </form>

  <div class="config-actions">
    <button 
      type="button" 
      class="action-btn save-btn" 
      [disabled]="!isFormValid()"
      (click)="saveConfig()">
      {{ isManualMode ? 'Salva' : 'Conferma' }}
    </button>
    <button 
      type="button" 
      class="action-btn cancel-btn" 
      (click)="cancel()">
      Annulla
    </button>
  </div>

</div>