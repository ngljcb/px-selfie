<div *ngIf="isOpen && note" 
     class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
     (click)="onBackdropClick($event)">

  <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col"
       (click)="$event.stopPropagation()">

    <header class="flex items-start justify-between p-6 border-b border-gray-200">
      <div class="flex-1 min-w-0 mr-4">
        <h1 class="text-2xl font-bold text-gray-900 break-words mb-2">
          {{ getDisplayTitle() }}
        </h1>

        <div class="space-y-2 text-sm text-gray-600">

          <div class="flex items-center">
            <span class="text-gray-500 w-20">Owner:</span>
            <span class="font-medium">{{ getCreatorDisplayName() }}</span>
          </div>

          <div class="flex items-center">
            <span class="text-gray-500 w-20">Date:</span>
            <span>{{ getFormattedCreationDate() }}</span>
          </div>

          <div class="flex items-center">
            <span class="text-gray-500 w-20">Visibility:</span>
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium"
                  [ngClass]="{
                    'bg-gray-100 text-gray-800': note.accessibility === 'private',
                    'bg-green-100 text-green-800': note.accessibility === 'public',
                    'bg-blue-100 text-blue-800': note.accessibility === 'authorized',
                    'bg-purple-100 text-purple-800': note.accessibility === 'group'
                  }">
              {{ getAccessibilityLabel() }}
            </span>
          </div>

          <div *ngIf="isGroupNote()" class="flex items-center">
            <span class="text-gray-500 w-20">Group:</span>
            <span class="font-medium text-purple-700">{{ getGroupDisplayName() }}</span>
          </div>

          <div *ngIf="note.category" class="flex items-center">
            <span class="text-gray-500 w-20">Category:</span>
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700">
              {{ note.category }}
            </span>
          </div>
        </div>
      </div>

      <button
        (click)="closeModal()"
        class="flex-shrink-0 p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"
        title="Close">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </header>

    <div class="flex-1 overflow-y-auto p-6">
      <div class="prose prose-gray max-w-none" 
           [innerHTML]="getFormattedContent()">
      </div>
    </div>
  </div>
</div>

<style>
  .prose {
    line-height: 1.6;
    color: #374151;
  }
  
  .prose p {
    margin-bottom: 1rem;
  }
  
  .prose h1,
  .prose h2,
  .prose h3 {
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
    font-weight: 600;
  }
  
  .prose code {
    background-color: #f3f4f6;
    padding: 0.125rem 0.25rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    font-family: 'Courier New', monospace;
  }
  
  .prose a {
    color: #2563eb;
    text-decoration: none;
  }
  
  .prose a:hover {
    text-decoration: underline;
  }
  
  @media (max-width: 768px) {
    .max-w-4xl {
      max-width: 100%;
      margin: 0.5rem;
    }
    
    .space-y-2 > div {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .space-y-2 > div span:first-child {
      width: auto;
      margin-bottom: 0.25rem;
      font-weight: 500;
    }
  }
</style>